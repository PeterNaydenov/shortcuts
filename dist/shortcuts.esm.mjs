import e from"@peter.naydenov/notice";var t={_findTarget:function(e,t){const{listenOptions:{clickTarget:n}}=t;return function e(t){const o=t;return o===document||o===document.body?null:o.dataset[n]||"A"===o.nodeName?o:e(o.parentNode)}},_listen:function(e,t){return function(){const{ev:n,inAPI:{_findTarget:o,_specialChars:r,_readKeyEvent:i,_readMouseEvent:s}}=e,{exposeShortcut:c,currentContext:u,streamKeys:a,listenOptions:l}=t,{mouseWait:m,keyWait:d,clickTarget:p,listenFor:h}=l;let y=[],k=null,f=null,g=null,x=null,T=null,C=!0,F=!1,I=0;const v=()=>C=!1,E=()=>C=!0,S=()=>F=!0,A=()=>!1===C;function O(){let t=y.map((e=>[e.join("+")]));if(!C){let e=t.at(-1);n.emit(e,{wait:v,end:E,ignore:S,isWaiting:A,note:u.note,context:u.name}),F&&(t=t.slice(0,-1),F=!1)}const o={wait:v,end:E,ignore:S,isWaiting:A,note:u.note,context:u.name,dependencies:e.extra};C&&(n.emit(t.join(","),o),c&&c({shortcut:t.join(","),context:u.name,note:u.note,dependencies:e.extra}),y=[],g=null)}function K(){const t=s(f,I),o={target:k,targetProps:k?k.getBoundingClientRect():null,x:f.clientX,y:f.clientY,context:u.name,note:u.note,event:f,dependencies:e.extra};n.emit(t.join("+"),o),c&&c({shortcut:t.join("+"),context:u.name,note:u.note,dependencies:e.extra}),x=null,T=null,k=null,f=null,I=0}h.includes("mouse")&&(window.addEventListener("contextmenu",(e=>{let t=l.maxClicks;return clearTimeout(x),T?(clearTimeout(T),void(T=setTimeout((()=>T=null),m))):(k=o(e.target),k&&k.dataset.hasOwnProperty("quickClick")&&(t=1),k&&"A"===k.tagName&&(t=1),f=e,I++,I>=t?(K(),void(t>1&&(T=setTimeout((()=>T=null),m)))):void(x=setTimeout(K,m)))})),document.addEventListener("click",(e=>{let t=l.maxClicks;return clearTimeout(x),T?(clearTimeout(T),void(T=setTimeout((()=>T=null),m))):(k=o(e.target),k&&k.dataset.hasOwnProperty("quickClick")&&(t=1),k&&"A"===k.tagName&&(t=1),f=e,I++,I>=t?(K(),void(t>1&&(T=setTimeout((()=>T=null),m)))):void(x=setTimeout(K,m)))}))),h.includes("keyboard")&&(document.addEventListener("keydown",(t=>{if(clearTimeout(g),r.hasOwnProperty(t.code))return y.push(i(t,r)),a&&a({key:t.key,context:u.name,note:u.note,dependencies:e.extra}),l.keyIgnore?(clearTimeout(l.keyIgnore),void(l.keyIgnore=setTimeout((()=>l.keyIgnore=null),d))):C&&y.length===l.maxSequence?(O(),void(l.keyIgnore=setTimeout((()=>l.keyIgnore=null),d))):void(C?g=setTimeout(O,d):O())})),document.addEventListener("keypress",(t=>{if(!r.hasOwnProperty(t.code)){if(clearTimeout(g),a&&a({key:t.key,context:u.name,note:u.note,dependencies:e.extra}),l.keyIgnore)return clearTimeout(l.keyIgnore),void(l.keyIgnore=setTimeout((()=>l.keyIgnore=null),d));if(y.push(i(t,r)),C&&y.length===l.maxSequence)return O(),void(l.keyIgnore=setTimeout((()=>l.keyIgnore=null),d));C?g=setTimeout(O,d):O()}})))}},_readKeyEvent:function(){return function(e,t){let{shiftKey:n,altKey:o,ctrlKey:r}=e,i=e.code.replace("Key","").replace("Digit",""),s=[];return r&&s.push("CTRL"),n&&s.push("SHIFT"),o&&s.push("ALT"),t.hasOwnProperty(i)?s.push(t[i].toUpperCase()):["ControlLeft","ControlRight","ShiftLeft","ShiftRight","AltLeft","AltRight","Meta"].includes(i)||s.push(i.toUpperCase()),s.sort()}},_readMouseEvent:function(){return function(e,t){let{shiftKey:n,altKey:o,ctrlKey:r,key:i,button:s}=e,c=`MOUSE-CLICK-${["LEFT","MIDDLE","RIGHT"][s]}-${t}`,u=[];return u.push(c),r&&u.push("CTRL"),n&&u.push("SHIFT"),o&&u.push("ALT"),u.sort()}},_readShortcut:function(){return function(e){return e.split(",").map((e=>e.trim())).map((e=>e.split("+").map((e=>e.toUpperCase())).sort().join("+"))).join(",")}},_specialChars:function(){return{ArrowLeft:"LEFT",ArrowUp:"UP",ArrowRight:"RIGHT",ArrowDown:"DOWN",Enter:"ENTER",NumpadEnter:"ENTER",Escape:"ESC",Backspace:"BACKSPACE",Space:"SPACE",Tab:"TAB",Backquote:"`",BracketLeft:"[",BracketRight:"]",Equal:"=",Slash:"/",Backslash:"\\",IntlBackslash:"`",F1:"F1",F2:"F2",F3:"F3",F4:"F4",F5:"F5",F6:"F6",F7:"F7",F8:"F8",F9:"F9",F10:"F10",F11:"F11",F12:"F12"}},changeContext:function(e,t){const{shortcuts:n,listenOptions:o,currentContext:r}=t,{ev:i}=e;return function(e=!1){const t=r.name;if(o.maxSequence=1,o.maxClicks=1,o.keyIgnore>=0&&(clearTimeout(o.keyIgnore),o.keyIgnore=null),!e)return i.reset(),void(r.name=null);t!==e&&(n[e]?(n[t]&&i.reset(),Object.entries(n[e]).forEach((([e,t])=>{if(e.includes("MOUSE-CLICK-")){let[,,,t]=e.split("-"),n=parseInt(t);o.maxClicks<n&&(o.maxClicks=n)}else{let t=e.split(",").length;o.maxSequence<t&&(o.maxSequence=t)}t.forEach((t=>i.on(e,t)))})),r.name=e):i.emit("shortcuts-error",`Context '${e}' does not exist`))}},listShortcuts:function(e,t){const n=t.shortcuts;return function(e=null){if(null!=e){let t=n[e];return null==t?null:Object.entries(t).map((([e,t])=>e))}return Object.keys(n).map((e=>{let t={};return t.context=e,t.shortcuts=Object.entries(n[e]).map((([e,t])=>e)),t}))}},load:function(e,t){const{shortcuts:n}=t,{inAPI:{_readShortcut:o},API:{changeContext:r,getContext:i}}=e;return function(e){const t=i(),s=Object.keys(e);let c=!1;s.forEach((r=>{const i=Object.entries(e[r]);r===t&&(c=!0),n[r]={},i.forEach((([e,t])=>{const i=o(e);t instanceof Function&&(t=[t]),n[r][i]=t}))})),c&&(r(),r(t))}},unload:function(e,t){const{currentContext:n,shortcuts:o}=t,{ev:r}=e;return function(e){n.name!==e?o[e]?delete o[e]:r.emit("shortcuts-error",`Context '${e}' does not exist`):r.emit("shortcuts-error",`Context '${e}' can't be removed during is current active context. Change the context first`)}}};function n(n={}){const o=e(),r={},i={},s={currentContext:{name:null,note:null},shortcuts:{},listenOptions:{mouseWait:n.mouseWait?n.mouseWait:320,maxClicks:1,keyWait:n.keyWait?n.keyWait:480,maxSequence:1,clickTarget:n.clickTarget?n.clickTarget:"click",listenFor:n.listenFor&&Array.isArray(n.listenFor)?n.listenFor:["mouse","keyboard"],keyIgnore:null},exposeShortcut:!(!n.onShortcut||"function"!=typeof n.onShortcut)&&n.onShortcut,streamKeys:!(!n.streamKeys||"function"!=typeof n.streamKeys)&&n.streamKeys},c={ev:o,inAPI:r,API:i,extra:{}};return i.getContext=()=>s.currentContext.name,i.getNote=()=>s.currentContext.note,i.setNote=(e=null)=>{"string"!=typeof e&&null!=e||(s.currentContext.note=e)},i.pause=(e="*")=>o.stop(r._readShortcut(e)),i.resume=(e="*")=>o.start(r._readShortcut(e)),i.emit=(e,...t)=>o.emit(r._readShortcut(e),c.extra,...t),i.listContexts=()=>Object.keys(shortcuts),i.setDependencies=e=>c.extra={...c.extra,...e},i.getDependencies=()=>c.extra,Object.entries(t).forEach((([e,t])=>{e.startsWith("_")?r[e]=t(c,s):i[e]=t(c,s)})),r._listen(),i}n.getDefaults=()=>({mouseWait:320,keyWait:480,clickTarget:"click",listenFor:["mouse","keyboard"],onShortcut:!1,streamKeys:!1});export{n as default};
