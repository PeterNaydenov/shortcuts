"use strict";var e=require("@peter.naydenov/notice");var t={_normalizeWithPlugins:function(e,t){return function(e){const n=t.shortcuts;Object.keys(n).forEach((t=>{Object.entries(n[t]).forEach((([o,r])=>{const s=e(o);s!==o&&(delete n[t][o],n[t][s]=r)}))}))}},changeContext:function(e,t){const{shortcuts:n,listenOptions:o,currentContext:r}=t,{ev:s}=e;return function(e=!1){const i=r.name;if(o.maxSequence=1,o.maxClicks=1,o.keyIgnore>=0&&(clearTimeout(o.keyIgnore),o.keyIgnore=null),!e)return s.reset(),void(r.name=null);i!==e&&(n[e]?(n[i]&&s.reset(),Object.entries(n[e]).forEach((([e,t])=>{if(e.includes("MOUSE-CLICK-")){let[,,,t]=e.split("-"),n=parseInt(t);o.maxClicks<n&&(o.maxClicks=n)}else{let t=e.split(",").length;o.maxSequence<t&&(o.maxSequence=t)}t.forEach((t=>s.on(e,t)))})),r.name=e,s.emit("@context-change",n[i]),s.on("*",((e,...n)=>{console.log("EEE"),t.exposeShortcut&&t.exposeShortcut(e,...n)}))):s.emit("shortcuts-error",`Context '${e}' does not exist`))}},listShortcuts:function(e,t){const n=t.shortcuts;return function(e=null){if(null!=e){let t=n[e];return null==t?null:Object.entries(t).map((([e,t])=>e))}return Object.keys(n).map((e=>{let t={};return t.context=e,t.shortcuts=Object.entries(n[e]).map((([e,t])=>e)),t}))}},load:function(e,t){const{shortcuts:n,plugins:o}=t,{API:{changeContext:r,getContext:s}}=e;return function(e){const t=s(),i=o.map((e=>e.getPrefix()));let c=!1;Object.entries(e).forEach((([e,r])=>{e===t&&(c=!0),n[e]={},Object.entries(r).forEach((([t,r])=>{let s=t,c=i.map(((e,t)=>s.startsWith(e)?t:null)).filter((e=>null!==e));if(c.length){let e=c[0];s=o[e].shortcutName(t)}r instanceof Function&&(r=[r]),n[e][s]=r}))})),c&&(r(),r(t))}},unload:function(e,t){const{currentContext:n,shortcuts:o}=t,{ev:r}=e;return function(e){n.name!==e?o[e]?delete o[e]:r.emit("shortcuts-error",`Context '${e}' does not exist`):r.emit("shortcuts-error",`Context '${e}' can't be removed during is current active context. Change the context first`)}}};function n(e){const t=e.toUpperCase();if(!t.includes("KEY:"))return e;return`KEY:${t.slice(4).split(",").map((e=>e.trim())).map((e=>e.split("+").map((e=>e.trim())).sort().join("+"))).join(",")}`}function o(e,t){let{shiftKey:n,altKey:o,ctrlKey:r}=e,s=e.code.replace("Key","").replace("Digit",""),i=[];return r&&i.push("CTRL"),n&&i.push("SHIFT"),o&&i.push("ALT"),t.hasOwnProperty(s)?i.push(t[s].toUpperCase()):["ControlLeft","ControlRight","ShiftLeft","ShiftRight","AltLeft","AltRight","Meta"].includes(s)||i.push(s.toUpperCase()),i.sort()}function r(e,t){let n=0;const{ev:o}=e,{listenOptions:r,currentContext:{name:s},shortcuts:i}=t;return null==s?0:(Object.entries(i[s]).forEach((([e,t])=>{if(!e.includes("KEY:"))return;n++;let s=e.slice(4).split(",").length;r.maxSequence<s&&(r.maxSequence=s),t.forEach((t=>o.on(e,t)))})),n)}function s(){return{ArrowLeft:"LEFT",ArrowUp:"UP",ArrowRight:"RIGHT",ArrowDown:"DOWN",Enter:"ENTER",NumpadEnter:"ENTER",Escape:"ESC",Backspace:"BACKSPACE",Space:"SPACE",Tab:"TAB",Backquote:"`",BracketLeft:"[",BracketRight:"]",Equal:"=",Slash:"/",Backslash:"\\",IntlBackslash:"`",F1:"F1",F2:"F2",F3:"F3",F4:"F4",F5:"F5",F6:"F6",F7:"F7",F8:"F8",F9:"F9",F10:"F10",F11:"F11",F12:"F12"}}function i(e,t,n){const{listenOptions:{clickTarget:o}}=t;let r=n;return r===document||r===document.body?null:r.dataset[o]||"A"===r.nodeName?r:i(e,t,r.parentNode)}function c(e){const t=e.toUpperCase(),n=t.includes("CLICK:"),o=["LEFT","MIDDLE","RIGHT"],r=["ALT","SHIFT","CTRL"];let s=null,i=[],c=0;return n?(t.slice(6).split("-").forEach((e=>{o.includes(e)?s=e:r.includes(e)?i.push(e):isNaN(e)||(c=e)})),`CLICK:${s}-${c}${i.length>0?"-":""}${i.sort().join("-")}`):e}function u(e,t){let{shiftKey:n,altKey:o,ctrlKey:r,key:s,button:i}=e,c=`CLICK:${["LEFT","MIDDLE","RIGHT"][i]}-${t}`,u=[];return r&&u.push("CTRL"),n&&u.push("SHIFT"),o&&u.push("ALT"),u.length>0?`${c}${u.length>0?"-":""}${u.sort().join("-")}`:`${c}`}function l(e,t){let n=0;const{ev:o}=e,{listenOptions:r,currentContext:{name:s},shortcuts:i}=t;return null==s?0:(Object.entries(i[s]).forEach((([e,t])=>{if(!e.includes("CLICK:"))return;n++;let[,s]=e.slice(6).split("-");r.maxClicks<s&&(r.maxClicks=s),t.forEach((t=>o.on(e,t)))})),n)}function a(n={}){const o=e(),r={},s={},i={currentContext:{name:null,note:null},shortcuts:{},listenOptions:{mouseWait:n.mouseWait?n.mouseWait:320,maxClicks:1,keyWait:n.keyWait?n.keyWait:480,maxSequence:1,clickTarget:n.clickTarget?n.clickTarget:"click",keyIgnore:null},plugins:[],exposeShortcut:!(!n.onShortcut||"function"!=typeof n.onShortcut)&&n.onShortcut,streamKeys:!(!n.streamKeys||"function"!=typeof n.streamKeys)&&n.streamKeys},c={ev:o,inAPI:r,API:s,extra:{}};function u(e,t,n=null){return i.plugins.findIndex((o=>o.getPrefix()===e&&(o[t]&&o[t](n),!0)))}return o.on("@context-change",(e=>i.plugins.map((t=>t.contextChange(e))))),s.enable=(e,t={})=>{if(-1===u(e.name,"none")){let n;n=e(c,i,t),i.plugins.push(n)}},s.disable=e=>{const t=u(e,"destroy");-1!==t&&(i.plugins=i.plugins.filter(((e,n)=>n!==t)))},s.mute=e=>u(e,"mute"),s.unmute=e=>u(e,"unmute"),s.getContext=()=>i.currentContext.name,s.getNote=()=>i.currentContext.note,s.setNote=(e=null)=>{"string"!=typeof e&&null!=e||(i.currentContext.note=e)},s.pause=(e="*")=>{const t=r._readShortcut(e);o.stop(t)},s.resume=(e="*")=>{const t=r._readShortcut(e);o.start(t)},s.emit=(e,...t)=>o.emit(r._readShortcut(e),c.extra,...t),s.listContexts=()=>Object.keys(i.shortcuts),s.setDependencies=e=>c.extra={...c.extra,...e},s.getDependencies=()=>c.extra,Object.entries(t).forEach((([e,t])=>{e.startsWith("_")?r[e]=t(c,i):s[e]=t(c,i)})),s}a.getDefaults=()=>({mouseWait:320,keyWait:480,clickTarget:"click",onShortcut:!1,streamKeys:!1}),exports.pluginClick=function(e,t,n){const{currentContext:o,shortcuts:r}=t,{inAPI:s}=e,a={ev:e.ev,_findTarget:i,_readClickEvent:u},m={currentContext:o,shortcuts:r,listenOptions:{mouseWait:n.mouseWait?n.mouseWait:320,maxClicks:1,clickTarget:n.clickTarget?n.clickTarget:"click"}};s._normalizeWithPlugins(c);let p=function(e,t){const{ev:n,_findTarget:o,_readClickEvent:r}=e,{listenOptions:s,currentContext:i}=t,{mouseWait:c}=s;let u=null,l=null,a=null,m=null,p=0;function h(){const t=r(l,p),o={target:u,targetProps:u?u.getBoundingClientRect():null,x:l.clientX,y:l.clientY,context:i.name,note:i.note,event:l,dependencies:e.extra,type:"click"};n.emit(t,o),a=null,m=null,u=null,l=null,p=0}function f(n){let r=s.maxClicks;return clearTimeout(a),m?(clearTimeout(m),void(m=setTimeout((()=>m=null),c))):(u=o(e,t,n.target),u&&u.dataset.hasOwnProperty("quickClick")&&(r=1),u&&"A"===u.tagName&&(r=1),l=n,p++,p>=r?(h(),void(r>1&&(m=setTimeout((()=>m=null),c)))):void(a=setTimeout(h,c)))}function d(n){let r=s.maxClicks;return clearTimeout(a),m?(clearTimeout(m),void(m=setTimeout((()=>m=null),c))):(u=o(e,t,n.target),u&&u.dataset.hasOwnProperty("quickClick")&&(r=1),u&&"A"===u.tagName&&(r=1),l=n,p++,p>=r?(h(),void(r>1&&(m=setTimeout((()=>m=null),c)))):void(a=setTimeout(h,c)))}return{start:function(){t.active||(window.addEventListener("contextmenu",d),document.addEventListener("click",f),t.active=!0)},stop:function(){t.active&&(window.removeEventListener("contextmenu",d),document.removeEventListener("click",f),t.active=!1)}}}(a,m),h=l(e,m);h>0&&p.start();const f={getPrefix:()=>"click",shortcutName:e=>c(e),contextChange:()=>{h=l(a,m),h<1&&p.stop(),h>0&&p.start()},mute:()=>p.stop(),unmute:()=>p.start(),destroy:()=>{p.stop(),m=null,f=null}};return Object.freeze(f),f},exports.pluginKey=function(e,t,i={}){const{currentContext:c,shortcuts:u}=t,{inAPI:l}=e,a={ev:e.ev,_specialChars:s,_readKeyEvent:o},m={currentContext:c,shortcuts:u,active:!1,listenOptions:{keyWait:i.keyWait?i.keyWait:480,maxSequence:1,keyIgnore:null},streamKeys:!(!i.streamKeys||"function"!=typeof i.streamKeys)&&i.streamKeys,exposeShortcut:exposeShortcut};l._normalizeWithPlugins(n);let p=function(e,t){const{ev:n,_specialChars:o,_readKeyEvent:r}=e,{currentContext:s,streamKeys:i,listenOptions:c}=t,{keyWait:u}=c;let l=[],a=null,m=!0,p=!1;const h=()=>m=!1,f=()=>m=!0,d=()=>p=!0,g=()=>!1===m;function x(){let t=l.map((e=>[e.join("+")]));if(!m){let e=t.at(-1);n.emit(e,{wait:h,end:f,ignore:d,isWaiting:g,note:s.note,context:s.name}),p&&(t=t.slice(0,-1),p=!1)}const o={wait:h,end:f,ignore:d,isWaiting:g,note:s.note,context:s.name,dependencies:e.extra};if(m){const e=`KEY:${t.join(",")}`;n.emit(e,o),l=[],a=null}}function k(t){if(clearTimeout(a),o.hasOwnProperty(t.code))return l.push(r(t,o)),i&&i({key:t.key,context:s.name,note:s.note,dependencies:e.extra}),c.keyIgnore?(clearTimeout(c.keyIgnore),void(c.keyIgnore=setTimeout((()=>c.keyIgnore=null),u))):m&&l.length===c.maxSequence?(x(),void(c.keyIgnore=setTimeout((()=>c.keyIgnore=null),u))):void(m?a=setTimeout(x,u):x())}function y(t){if(!o.hasOwnProperty(t.code)){if(clearTimeout(a),i&&i({key:t.key,context:s.name,note:s.note,dependencies:e.extra}),c.keyIgnore)return clearTimeout(c.keyIgnore),void(c.keyIgnore=setTimeout((()=>c.keyIgnore=null),u));if(l.push(r(t,o)),m&&l.length===c.maxSequence)return x(),void(c.keyIgnore=setTimeout((()=>c.keyIgnore=null),u));m?a=setTimeout(x,u):x()}}return{start:function(){t.active||(console.log("listen"),document.addEventListener("keydown",k),document.addEventListener("keypress",y),t.active=!0)},stop:function(){t.active&&(document.removeEventListener("keydown",k),document.removeEventListener("keypress",y),t.active=!1)}}}(a,m),h=r(e,m);h>0&&p.start();const f={getPrefix:()=>"key",shortcutName:e=>n(e),contextChange:e=>{h=r(a,m),h<1&&p.stop(),h>0&&p.start()},mute:()=>p.stop(),unmute:()=>p.start(),destroy:()=>{p.stop(),m=null,f=null}};return Object.freeze(f),f},exports.shortcuts=a;
