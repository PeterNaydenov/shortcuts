!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).shortcuts={})}(this,function(e){"use strict";var t={_normalizeWithPlugins:function(e,t){return function(e){const n=t.shortcuts;Object.keys(n).forEach(t=>{Object.entries(n[t]).forEach(([i,o])=>{const r=e(i);r!==i&&(delete n[t][i],n[t][r]=o)})})}},_readShortcutWithPlugins:function(e,t){return function(n){const{inAPI:i}=e,o=n.split(":")[0].toLowerCase().trim(),r=i._systemAction(o,"none");let s=n;return-1!==r&&(s=t.plugins[r].shortcutName(n)),s}},_setupPlugin:function(e,t){const{inAPI:n}=e,{currentContext:i,shortcuts:o,exposeShortcut:r,ERROR_EVENT_NAME:s}=t;return function(t){const{prefix:l,_normalizeShortcutName:c,_registerShortcutEvents:u,_listenDOM:a,pluginState:d,deps:f}=t,{resetState:p}=f;d.currentContext=i,d.shortcuts=o,d.exposeShortcut=r,d.ERROR_EVENT_NAME=s;const h={ev:e.ev,extra:e.extra,...f};n._normalizeWithPlugins(c);let m=u(h,d),g=a(h,d);m>0&&g.start();let v={getPrefix:()=>l,shortcutName:e=>c(e),contextChange:()=>{p(),m=u(h,d),m<1&&g.stop(),m>0&&g.start()},mute:()=>g.stop(),unmute:()=>g.start(),destroy:()=>{g.stop(),p()}};return Object.freeze(v),v}},_systemAction:function(e,t){return function(e,n,i=null){return t.plugins.findIndex(t=>t.getPrefix()===e&&(t[n]&&t[n](i),!0))}},changeContext:function(e,t){const{shortcuts:n,currentContext:i,ERROR_EVENT_NAME:o}=t,{ev:r}=e;return function(e=!1){const s=i.name;if(!e)return r.reset(),void(i.name=null);s!==e&&(n[e]?(n[s]&&r.reset(),i.name=e,t.plugins.forEach(t=>t.contextChange(e)),Object.entries(n[e]).forEach(([e,t])=>{e.includes(":SETUP")||t.forEach(t=>r.on(e,t))}),r.on("*",(...e)=>{t.exposeShortcut&&t.exposeShortcut(...e)})):r.emit(o,`Context '${e}' does not exist`))}},listShortcuts:function(e,t){const n=t.shortcuts;return function(e=null){if(null!=e){let t=n[e];return null==t?null:Object.entries(t).map(([e,t])=>e)}return Object.keys(n).map(e=>{let t={};return t.context=e,t.shortcuts=Object.entries(n[e]).map(([e,t])=>e),t})}},load:function(e,t){const{shortcuts:n,plugins:i}=t,{API:{changeContext:o,getContext:r}}=e;return function(e){const t=r(),s=i.map(e=>e.getPrefix().toUpperCase());let l=!1;Object.entries(e).forEach(([e,o])=>{e===t&&(l=!0),n[e]={},Object.entries(o).forEach(([t,o])=>{let r=t,l=t.toUpperCase().trim(),c=s.map((e,t)=>l.startsWith(e)?t:null).filter(e=>null!==e);if(c.length){let e=c[0];r=i[e].shortcutName(t)}o instanceof Function&&(o=[o]),n[e][r]=o})}),l&&(o(),o(t))}},unload:function(e,t){const{currentContext:n,shortcuts:i,ERROR_EVENT_NAME:o}=t,{ev:r}=e;return function(e){n.name!==e?i[e]?delete i[e]:r.emit(o,`Context '${e}' does not exist`):r.emit(o,`Context '${e}' can't be removed during is current active context. Change the context first`)}}};function n(e,t){const{ev:n,_specialChars:i,_readKeyEvent:o,extra:r,resetState:s}=e,{currentContext:l,streamKeys:c,listenOptions:u}=t;let a=[],d=null,f=!0,p=!1;const h=()=>f=!1,m=()=>f=!0,g=()=>p=!0,v=()=>!1===f;function x(){let e=a.map(e=>[e.join("+")]);const i={wait:h,end:m,ignore:g,isWaiting:v,note:l.note,context:l.name,dependencies:r,options:t.listenOptions,viewport:{X:window.scrollX,Y:window.scrollY,width:window.innerWidth,height:window.innerHeight},type:"key"};if(!f){let t=`KEY:${e.at(-1).join("+")}`;n.emit(t,i),p&&(a=a.slice(0,-1),p=!1)}if(f){const o=`KEY:${e.join(",")}`;n.emit(o,i),p&&(a=a.slice(0,-1),p=!1),a=[],clearTimeout(t.keyIgnore),t.keyIgnore=null,clearTimeout(d),d=null}}function E(n){if(clearTimeout(d),i().hasOwnProperty(n.code))return a.push(o(n,i)),c&&c({key:n.key,context:l.name,note:l.note,dependencies:e.extra}),t.keyIgnore?(clearTimeout(t.keyIgnore),t.keyIgnore=setTimeout(()=>t.keyIgnore=null,u.keyWait),void a.pop()):f&&a.length===t.maxSequence?(x(),void(t.keyIgnore=setTimeout(()=>t.keyIgnore=null,u.keyWait))):void(f?d=setTimeout(x,u.keyWait):x())}function O(n){if(!i().hasOwnProperty(n.code)){if(clearTimeout(d),c&&c({key:n.key,context:l.name,note:l.note,dependencies:e.extra}),t.keyIgnore)return clearTimeout(t.keyIgnore),void(t.keyIgnore=setTimeout(()=>t.keyIgnore=null,u.keyWait));if(a.push(o(n,i)),f&&a.length===t.maxSequence)return x(),void(t.keyIgnore=setTimeout(()=>t.keyIgnore=null,u.keyWait));f?d=setTimeout(x,u.keyWait):x()}}return{start:function(){t.active||(document.addEventListener("keydown",E),document.addEventListener("keypress",O),t.active=!0)},stop:function(){t.active&&(document.removeEventListener("keydown",E),document.removeEventListener("keypress",O),t.active=!1,d&&(clearTimeout(d),d=null),t.keyIgnore&&(clearTimeout(t.keyIgnore),t.keyIgnore=null),a=[],f=!0,p=!1)}}}function i(e){const t=e.toUpperCase(),n=/KEY\s*\:/i.test(t),i=t.indexOf(":");if(!n)return e;if(t.includes("SETUP"))return"KEY:SETUP";return`KEY:${t.slice(i+1).split(",").map(e=>e.trim()).map(e=>e.split("+").map(e=>e.trim()).sort().join("+")).join(",")}`}function o(e,t){let{shiftKey:n,altKey:i,ctrlKey:o}=e,r=t(),s=e.code.replace("Key","").replace("Digit",""),l=[];return o&&l.push("CTRL"),n&&l.push("SHIFT"),i&&l.push("ALT"),r.hasOwnProperty(s)?l.push(r[s].toUpperCase()):["ControlLeft","ControlRight","ShiftLeft","ShiftRight","AltLeft","AltRight","Meta"].includes(s)||l.push(s.toUpperCase()),l.sort()}function r(e,t){let n=0,i=!1;const o=t.defaultOptions,{regex:r}=e,{currentContext:{name:s},shortcuts:l}=t;return null==s?0:(Object.entries(l[s]).forEach(([s,l])=>{if(!r.test(s))return;if("KEY:SETUP"===s){i=!0;let n=l.reduce((n,i)=>{let o=i({dependencies:e.extra,defaults:structuredClone(t.defaultOptions),options:t.listenOptions});return Object.assign(n,o)},o);return void Object.assign(t.listenOptions,n)}n++;let c=s.slice(4).split(",").length;t.maxSequence<c&&(t.maxSequence=c)}),i||Object.assign(t.listenOptions,o),n)}function s(){return{ArrowLeft:"LEFT",ArrowUp:"UP",ArrowRight:"RIGHT",ArrowDown:"DOWN",Enter:"ENTER",NumpadEnter:"ENTER",Escape:"ESC",Backspace:"BACKSPACE",Space:"SPACE",Tab:"TAB",Backquote:"`",BracketLeft:"[",BracketRight:"]",Equal:"=",Slash:"/",Backslash:"\\",IntlBackslash:"`",F1:"F1",F2:"F2",F3:"F3",F4:"F4",F5:"F5",F6:"F6",F7:"F7",F8:"F8",F9:"F9",F10:"F10",F11:"F11",F12:"F12"}}function l(e,t,n){const{listenOptions:{clickTarget:i}}=t;let o=n;return o===document.body?null:o.dataset[i]||"A"===o.nodeName?o:l(e,t,o.parentNode)}function c(e,t){const{ev:n,_findTarget:i,_readClickEvent:o,extra:r}=e,{listenOptions:s,currentContext:l}=t;let c=null,u=null,a=null,d=null,f=0;function p(){if(!c)return;let{left:e,top:i,width:s,height:p}=c.getBoundingClientRect(),h=window.scrollX,m=window.scrollY;const g=o(u,f),v={target:c,x:u.clientX,y:u.clientY,context:l.name,note:l.note,options:t.listenOptions,event:u,dependencies:r,viewport:{X:h,Y:m,width:window.innerWidth,height:window.innerHeight},sizes:{width:s,height:p},position:{x:e,y:i},pagePosition:{x:e+h,y:i+m},type:"click"};n.emit(g,v),a=null,d=null,c=null,u=null,f=0}function h(n){let o=t.maxLeftClicks;if(clearTimeout(a),d)return clearTimeout(d),void(d=setTimeout(()=>d=null,s.mouseWait));if(c=i(e,t,n.target),null!=c){if(c&&c.dataset.hasOwnProperty("quickClick")&&(o=1),c&&"A"===c.tagName&&(o=1),u=n,f++,f>=o)return p(),void(o>1&&(d=setTimeout(()=>d=null,s.mouseWait)));a=setTimeout(p,s.mouseWait)}}function m(n){let o=t.maxRightClicks;if(clearTimeout(a),d)return clearTimeout(d),void(d=setTimeout(()=>d=null,s.mouseWait));if(c=i(e,t,n.target),null!=c){if(c&&c.dataset.hasOwnProperty("quickClick")&&(o=1),c&&"A"===c.tagName&&(o=1),u=n,f++,f>=o)return p(),void(o>1&&(d=setTimeout(()=>d=null,s.mouseWait)));a=setTimeout(p,s.mouseWait)}}return{start:function(){t.active||(window.addEventListener("contextmenu",m),document.addEventListener("click",h),t.active=!0)},stop:function(){t.active&&(window.removeEventListener("contextmenu",m),document.removeEventListener("click",h),t.active=!1,d&&(clearTimeout(d),d=null),c=null,u=null,f=0)}}}function u(e){const t=e.toUpperCase(),n=/CLICK\s*\:/i.test(t),i=["LEFT","MIDDLE","RIGHT"],o=["ALT","SHIFT","CTRL"];let r=null,s=[],l=0,c=t.indexOf(":");return n?t.includes("SETUP")?"CLICK:SETUP":(t.slice(c+1).trim().split("-").map(e=>e.trim()).forEach(e=>{i.includes(e)?r=e:o.includes(e)?s.push(e):isNaN(e)||(l=e)}),`CLICK:${r}-${l}${s.length>0?"-":""}${s.sort().join("-")}`):e}function a(e,t){let{shiftKey:n,altKey:i,ctrlKey:o,key:r,button:s}=e,l=`CLICK:${["LEFT","MIDDLE","RIGHT"][s]}-${t}`,c=[];return o&&c.push("CTRL"),n&&c.push("SHIFT"),i&&c.push("ALT"),c.length>0?`${l}${c.length>0?"-":""}${c.sort().join("-")}`:`${l}`}function d(e,t){let n=0,i=!1;const o=t.defaultOptions,{regex:r}=e,{listenOptions:s,currentContext:{name:l},shortcuts:c}=t;return null==l||(Object.entries(c[l]).forEach(([l,c])=>{if(!r.test(l))return;if("CLICK:SETUP"===l){i=!0;let n=c.reduce((n,i)=>{let o=i({dependencies:e.extra,defaults:structuredClone(t.defaultOptions),options:s});return Object.assign(n,o)},o);return void Object.assign(t.listenOptions,n)}n++;let[u,a]=l.slice(6).split("-");"LEFT"===u&&t.maxLeftClicks<a&&(t.maxLeftClicks=a),"RIGHT"===u&&t.maxRightClicks<a&&(t.maxRightClicks=a)}),i||Object.assign(t.listenOptions,o)),n}function f(e,t){const{ev:n}=e;let i=null;function o(e,t,n,i){let{left:o,top:r,width:s,height:l}=n.target.getBoundingClientRect(),c=window.scrollX,u=window.scrollY;return{target:n.target,context:t.currentContext.name,note:t.currentContext.note,event:n,dependencies:e.extra,options:t.listenOptions,viewport:{X:c,Y:u,width:window.innerWidth,height:window.innerHeight},sizes:{width:s,height:l},position:{x:o,y:r},pagePosition:{x:o+c,y:r+u},type:i}}function r(i){const{callbacks:r,typeFn:s}=t;i.target;const l=o(e,t,i,"form-in"),c=`${s(l)}/in`;null!=r[c]&&n.emit(c,l,r[c])}function s(i){const{callbacks:r,typeFn:s}=t,l=o(e,t,i,"form-out"),c=`${s(l)}/out`;null!=r[c]&&n.emit(c,l,r[c])}function l(r){const{callbacks:s,typeFn:l}=t,c=o(e,t,r,"form-instant"),u=l(c),a=t.wait[`${u}`],d=`${u}/instant`;if(null==s[d])return;if(0===a)return void n.emit(d,c,s[d]);clearTimeout(i),i=setTimeout(()=>n.emit(d,c,s[d]),a)}return{start:function(){t.active||(document.addEventListener("focusin",r),document.addEventListener("focusout",s),document.addEventListener("input",l),t.active=!0)},stop:function(){t.active&&(document.removeEventListener("focusin",r),document.removeEventListener("focusout",s),document.removeEventListener("input",l),t.active=!1,i&&(clearTimeout(i),i=null))}}}function p(e){const t=e.toUpperCase(),n=/FORM\s*\:/i.test(t),i=t.indexOf(":");if(!n)return e;return`FORM:${t.slice(i+1).trim()}`}function h(e,t){const{regex:n,_defaults:i,ev:o}=e,{currentContext:{name:r,note:s},shortcuts:l,callbacks:c,ERROR_EVENT_NAME:u,defaultOptions:a}=t;let d=[],f=[],p=[],h=0;if(null==r)return!1;if(Object.entries(l[r]).forEach(([i,o])=>{if(n.test(i)){if(i.includes("SETUP")){let n=o.reduce((n,i)=>{let o=i({dependencies:e.extra,defaults:structuredClone(t.defaultOptions),options:t.listenOptions});return Object.assign(n,o)},a);return void Object.assign(t.listenOptions,n)}"FORM:WATCH"===i&&(d=o),"FORM:DEFINE"===i&&(f=o),"FORM:ACTION"===i&&(p=o)}}),0===p.length)return h;let m=new Set;0===f.length&&(f=[i.define]),0===d.length&&(d=[i.watch]);let g=d.map(n=>n({dependencies:e.extra,context:r,note:s,options:t.listenOptions})).reduce((e,t)=>(e.push(t),e),[]);return t.watchList=document.querySelectorAll(g),t.watchList.forEach(n=>{let{left:i,top:o,width:l,height:c}=n.getBoundingClientRect(),u=window.scrollX,a=window.scrollY;return m.add(f[0]({target:n,context:r,note:s,dependencies:e.extra,options:t.listenOptions,viewport:{X:u,Y:a,width:window.innerWidth,height:window.innerHeight},sizes:{width:l,height:c},position:{x:i,y:o},pagePosition:{x:i+u,y:o+a}}))}),t.typeFn=f[0]?f[0]:i.define,p.forEach(n=>{if(!(n instanceof Function))return o.emit(u,"The 'form:action' should be a function."),!1;let i=n({dependencies:e.extra,options:t.listenOptions});if(!(i instanceof Array))return o.emit(u,"Warning: The 'form:action' function should RETURN an array."),!1;i.forEach(({fn:e,type:n,timing:i,wait:r=0})=>{if(m.has(n)&&e instanceof Function){let t=`${n}/${i}`;const r=c.hasOwnProperty(t);r?c[t].push(e):c[t]=[e],r||o.on(t,(e,t)=>{t.forEach(t=>{t instanceof Function&&t(e)})})}"instant"===i&&(t.wait[`${n}`]=r)})}),h=Object.keys(t.callbacks).length,h}const m={watch:()=>"input, select, textarea, button, a",define:({target:e})=>"checkbox"===e.type||"radio"===e.type?"checkbox":"button"==e.type||"submit"==e.type?"button":"input"};function g(e,t,n){const{listenOptions:{hoverTarget:i}}=t;let o=n;return o!==document&&(o!==document.body&&(o.dataset[i]?o:g(e,t,o.parentNode)))}function v(e,t){const{ev:n,_findTarget:i,resetState:o,extra:r}=e;function s(o){const s=o.clientX,l=o.clientY;let{hovered:c,hoverRectangle:u,listenOptions:a,hoverTimer:d,leaveTimer:f,lastEvent:p,lastHoverTarget:h}=t,m=i(e,t,o.target);if(!function(e,t,n){return!!e&&t>=e.left&&t<=e.right&&n>=e.top&&n<=e.bottom}(u,s,l)&&m!==c){if(c&&!m){if(t.hovered=!1,t.hoverRectangle=null,d&&(clearTimeout(d),t.hoverTimer=null),"off"===p)return;return void(t.leaveTimer=setTimeout(()=>{n.emit("HOVER:OFF",g(c)),t.leaveTimer=null,t.lastEvent="off"},a.wait))}c&&(n.emit("HOVER:OFF",g(c)),t.leaveTimer=null,t.lastEvent="off"),clearTimeout(f),clearTimeout(d),t.hovered=m,t.hoverRectangle=m.getBoundingClientRect(),t.hoverTimer=setTimeout(()=>{n.emit("HOVER:ON",g(m)),t.hoverTimer=null,t.lastHoverTarget=m,t.lastEvent="on"},a.wait)}function g(e){let{left:n,top:i,width:s,height:l}=e.getBoundingClientRect(),c=window.scrollX,u=window.scrollY;return{target:e,context:t.currentContext.name,note:t.currentContext.note,event:o,dependencies:r,options:t.listenOptions,viewport:{X:c,Y:u,width:window.innerWidth,height:window.innerHeight},sizes:{width:s,height:l},position:{x:n,y:i},pagePosition:{x:n+c,y:i+u},type:"hover"}}}return{start:function(){t.active||(document.addEventListener("mousemove",s),t.active=!0)},stop:function(){t.active&&(document.removeEventListener("mousemove",s),o())}}}function x(e){const t=e.toUpperCase(),n=/HOVER\s*\:/i.test(t);let i=t.indexOf(":");return n?`HOVER:${t.slice(i+1).trim()}`:e}function E(e,t){let n=0,i=!1;const o=t.defaultOptions,{regex:r,_defaults:s,ev:l}=e,{currentContext:{name:c},shortcuts:u,ERROR_EVENT_NAME:a}=t;return null==c||(Object.entries(u[c]).forEach(([s,l])=>{if(r.test(s)){if("HOVER:SETUP"===s){i=!0;let n=l.reduce((n,i)=>{let o=i({dependencies:e.extra,defaults:structuredClone(t.defaultOptions),options:t.listenOptions});return Object.assign(n,o)},o);return void Object.assign(t.listenOptions,n)}n++}}),i||Object.assign(t.listenOptions,o)),n}function O(e,t){const{ev:n,resetState:i,extra:o}=e;let r=null,s=null;function l(e){e.clientX,e.clientY;const{lastPosition:i,lastDirection:l,listenOptions:c,currentContext:u}=t,{scrollWait:a,endScrollWait:d,minSpace:f}=c;if(!i)return;let p=null,h=window.scrollX,m=window.scrollY,g=Math.abs(m-i.y),v=Math.abs(h-i.x);if(g<f&&v<f)return;const x=[];g>=f&&(m>i.y?x.push("down"):x.push("up")),v>=f&&(h>i.x?x.push("right"):x.push("left")),p=x[0]||null;const E=e=>({x:h,y:m,direction:e,context:u.name,note:u.note,dependencies:o,options:t.listenOptions,viewport:{X:h,Y:m,width:window.innerWidth,height:window.innerHeight},type:"scroll"});x.forEach(e=>{const t=`SCROLL:${e.toUpperCase()}`;n.emit(t,E(e))}),clearTimeout(r),clearTimeout(s);const O=x[x.length-1]||null;r=setTimeout(()=>{},a),s=setTimeout(()=>n.emit("SCROLL:END",E(O)),d),t.lastPosition={x:h,y:m},t.lastDirection=p}return{start:function(){t.active||(t.lastPosition={x:window.scrollX,y:window.scrollY},window.addEventListener("scroll",l),t.active=!0)},stop:function(){t.active&&(window.removeEventListener("scroll",l),i())}}}function y(e){const t=e.toUpperCase(),n=/SCROLL\s*\:/i.test(t);let i=t.indexOf(":");return n?`SCROLL:${t.slice(i+1).trim()}`:e}function w(e,t){let n=0,i=!1;const o=t.defaultOptions,{regex:r}=e,{currentContext:{name:s},shortcuts:l}=t;return null==s||(Object.entries(l[s]).forEach(([s,l])=>{if(r.test(s)){if("SCROLL:SETUP"===s){i=!0;let n=l.reduce((n,i)=>{let o=i({dependencies:e.extra,defaults:structuredClone(t.defaultOptions),options:t.listenOptions});return Object.assign(n,o)},o);return void Object.assign(t.listenOptions,n)}n++}}),i||Object.assign(t.listenOptions,o)),n}e.pluginClick=function(e,t={}){let n={_findTarget:l,_readClickEvent:a,regex:/CLICK\s*\:/i},i={active:!1,maxLeftClicks:1,maxRightClicks:1,defaultOptions:{mouseWait:320,clickTarget:"click"},listenOptions:{mouseWait:320,clickTarget:"click"},streamKeys:!(!t.streamKeys||"function"!=typeof t.streamKeys)&&t.streamKeys};return n.resetState=function(){},e({prefix:"click",_normalizeShortcutName:u,_registerShortcutEvents:d,_listenDOM:c,pluginState:i,deps:n})},e.pluginForm=function(e,t={}){let n={_defaults:m,regex:/FORM\s*\:/i},i={callbacks:{},typeFn:"",watchList:[],wait:{},defaultOptions:{},listenOptions:{}};return n.resetState=function(){i.callbacks={},i.typeFn="",i.watchList=[],i.wait={}},e({prefix:"form",_normalizeShortcutName:p,_registerShortcutEvents:h,_listenDOM:f,pluginState:i,deps:n})},e.pluginHover=function(e,t={}){let n={_findTarget:g,regex:/HOVER\s*\:/i},i={active:!1,hovered:!1,hoverRectangle:null,hoverTimer:null,leaveTimer:null,lastEvent:"",lastHoverTarget:null,defaultOptions:{hoverTarget:"hover",wait:320},listenOptions:{hoverTarget:"hover",wait:320}};return n.resetState=function(){i.active=!1,i.hovered=!1,i.hoverRectangle=null,clearTimeout(i.hoverTimer),clearTimeout(i.leaveTimer),i.hoverTimer=null,i.leaveTimer=null,i.lastHoverTarget=null},e({prefix:"hover",_normalizeShortcutName:x,_registerShortcutEvents:E,_listenDOM:v,pluginState:i,deps:n})},e.pluginKey=function(e,t={}){let l={_specialChars:s,_readKeyEvent:o,regex:/KEY\s*\:/i},c={active:!1,maxSequence:1,keyIgnore:null,defaultOptions:{keyWait:480},listenOptions:{keyWait:480},streamKeys:!(!t.streamKeys||"function"!=typeof t.streamKeys)&&t.streamKeys};return l.resetState=function(){c.active=!1,c.keyIgnore=null,c.maxSequence=1},e({prefix:"key",_normalizeShortcutName:i,_registerShortcutEvents:r,_listenDOM:n,pluginState:c,deps:l})},e.pluginScroll=function(e,t={}){let n={regex:/SCROLL\s*\:/i},i={active:!1,lastPosition:null,lastDirection:null,defaultOptions:{scrollWait:50,endScrollWait:400,minSpace:40},listenOptions:{scrollWait:50,endScrollWait:400,minSpace:40}};return n.resetState=function(){i.active=!1},e({prefix:"scroll",_normalizeShortcutName:y,_registerShortcutEvents:w,_listenDOM:O,pluginState:i,deps:n})},e.shortcuts=function(e={}){let n={},i={};const o=function(){let e={"*":[]},t={},n=new Set,i=!1,o="";return{on:function(t,n){e[t]||(e[t]=[]),e[t].push(n)},once:function(e,n){"*"!==e&&(t[e]||(t[e]=[]),t[e].push(n))},off:function(n,i){if(i)return e[n]&&(e[n]=e[n].filter(e=>e!==i)),t[n]&&(t[n]=t[n].filter(e=>e!==i)),e[n]&&0===e[n].length&&delete e[n],void(t[n]&&0===t[n].length&&delete e[n]);t[n]&&delete t[n],e[n]&&delete e[n]},reset:function(){e={"*":[]},t={},n=new Set},emit:function(){const[r,...s]=arguments;function l(t){let i=!1;"*"!==t&&(n.has(t)||(e[t].every(e=>{const t=e(...s);return"string"!=typeof t||"STOP"!==t.toUpperCase()||(i=!0,!1)}),i||e["*"].forEach(e=>e(r,...s))))}if(i&&(console.log(`${o} Event "${r}" was triggered.`),s.length>0&&(console.log("Arguments:"),console.log(...s),console.log("^----"))),"*"!==r){if(t[r]){if(n.has(r))return;t[r].forEach(e=>e(...s)),delete t[r]}e[r]&&l(r)}else Object.keys(e).forEach(e=>l(e))},stop:function(i){if("*"===i){const i=Object.keys(e),o=Object.keys(t);return void(n=new Set([...o,...i]))}n.add(i)},start:function(e){"*"!==e?n.delete(e):n.clear()},debug:function(e,t){i=!!e,t&&"string"==typeof t&&(o=t)}}}(),r={currentContext:{name:null,note:null},shortcuts:{},plugins:[],exposeShortcut:!(!e.onShortcut||"function"!=typeof e.onShortcut)&&e.onShortcut,ERROR_EVENT_NAME:e.errorEventName?e.errorEventName:"@shortcuts-error"};let s={ev:o,inAPI:n,API:i,extra:{}};return i.enablePlugin=(e,t={})=>{if("function"!=typeof e)return;let i=e(n._setupPlugin,t);const o=i.getPrefix(),s=n._systemAction(o,"none");-1===s?(r.plugins.push(i),i.unmute()):(i.destroy(),r.plugins[s].unmute())},i.disablePlugin=e=>{const t=n._systemAction(e,"destroy");-1!==t&&r.plugins.splice(t,1)},i.mutePlugin=e=>n._systemAction(e,"mute"),i.unmutePlugin=e=>n._systemAction(e,"unmute"),i.listPlugins=()=>r.plugins.map(e=>e.getPrefix()),i.getContext=()=>r.currentContext.name,i.getNote=()=>r.currentContext.note,i.setNote=(e=null)=>{"string"!=typeof e&&null!=e||(r.currentContext.note=e)},i.pause=(e="*")=>{let t=n._readShortcutWithPlugins(e);o.stop(t)},i.resume=(e="*")=>{const t=n._readShortcutWithPlugins(e);o.start(t)},i.emit=(e,...t)=>o.emit(n._readShortcutWithPlugins(e),...t),i.listContexts=()=>Object.keys(r.shortcuts),i.setDependencies=e=>Object.assign(s.extra,e),i.getDependencies=()=>s.extra,i.reset=function(){o.reset(),i.changeContext(),r.plugins.forEach(e=>e.destroy()),i.listContexts().map(e=>i.unload(e)),s.extra={},r.exposeShortcut=null},Object.entries(t).forEach(([e,t])=>{e.startsWith("_")?n[e]=t(s,r):i[e]=t(s,r)}),i}});
